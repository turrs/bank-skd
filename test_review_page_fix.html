<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Review Page Fix</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        .test-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .demo-panel {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        .control-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        .btn-primary { background: #2196F3; color: white; }
        .btn-success { background: #4CAF50; color: white; }
        .btn-warning { background: #FF9800; color: white; }
        .btn-danger { background: #f44336; color: white; }
        .control-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); }
        .log-panel {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .log-entry {
            margin: 5px 0;
            padding: 8px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9rem;
        }
        .log-info { background: rgba(33, 150, 243, 0.2); }
        .log-success { background: rgba(76, 175, 80, 0.2); }
        .log-warning { background: rgba(255, 193, 7, 0.2); }
        .log-error { background: rgba(244, 67, 54, 0.2); }
        .fix-panel {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .code-block {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
            font-family: monospace;
            font-size: 12px;
            line-height: 1.6;
            overflow-x: auto;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background: #4CAF50; }
        .status-warning { background: #FF9800; }
        .status-error { background: #f44336; }
        .status-info { background: #2196F3; }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚úÖ Test Review Page Fix</h1>
        
        <div class="test-section">
            <h3>üìã Test Overview</h3>
            <p>Verifikasi fix untuk error "Cannot access 'loadTagStats' before initialization"</p>
        </div>

        <div class="fix-panel">
            <h3>üîß Fix Applied</h3>
            <div class="code-block">
                <div style="color: #FF6B6B;">// ‚ùå BEFORE: Function called before declaration</div>
                <div>useEffect(() => {</div>
                <div>  if (session && session.status === 'completed') {</div>
                <div>    loadTagStats(); // ‚Üê Error: loadTagStats belum dideklarasikan</div>
                <div>  }</div>
                <div>}, [session]);</div>
                <div></div>
                <div style="color: #4ECDC4;">// ‚úÖ AFTER: Function declared before use</div>
                <div>const loadTagStats = async () => {</div>
                <div>  if (!sessionId) return;</div>
                <div>  setLoadingTagStats(true);</div>
                <div>  try {</div>
                <div>    const statsResult = await QuestionTagStats.list();</div>
                <div>    const stats = Array.isArray(statsResult?.data) ? </div>
                <div>      statsResult.data.filter((s: any) => s.session_id === sessionId) : [];</div>
                <div>    setTagStats(stats);</div>
                <div>  } catch (error) {</div>
                <div>    console.error("Error loading tag stats:", error);</div>
                <div>  } finally {</div>
                <div>    setLoadingTagStats(false);</div>
                <div>  }</div>
                <div>};</div>
                <div></div>
                <div>useEffect(() => {</div>
                <div>  if (session && session.status === 'completed') {</div>
                <div>    loadTagStats(); // ‚Üê ‚úÖ Now function is declared</div>
                <div>  }</div>
                <div>}, [session]);</div>
            </div>
        </div>

        <div class="demo-panel">
            <h3>üéØ Test Controls</h3>
            <div class="controls">
                <button class="control-btn btn-primary" onclick="testFunctionOrder()">Test Function Order</button>
                <button class="control-btn btn-success" onclick="testHoisting()">Test Hoisting</button>
                <button class="control-btn btn-warning" onclick="testErrorPrevention()">Test Error Prevention</button>
                <button class="control-btn btn-danger" onclick="testComponentFlow()">Test Component Flow</button>
                <button class="control-btn btn-primary" onclick="simulateFix()">Simulate Fix</button>
            </div>
        </div>

        <div class="test-section">
            <h3>üêõ Problem Analysis</h3>
            <div class="code-block">
                <div style="color: #FF6B6B;">// ‚ùå PROBLEM: JavaScript Hoisting Issue</div>
                <div>// Function expressions (const loadTagStats = ...) are NOT hoisted</div>
                <div>// Only function declarations (function loadTagStats() {...}) are hoisted</div>
                <div></div>
                <div style="color: #FFE66D;">// ‚ùå This causes the error:</div>
                <div>// "Cannot access 'loadTagStats' before initialization"</div>
                <div></div>
                <div style="color: #4ECDC4;">// ‚úÖ SOLUTION: Move function declaration before usage</div>
                <div>// OR use function declaration instead of function expression</div>
            </div>
        </div>

        <div class="test-section">
            <h3>üìö JavaScript Hoisting Rules</h3>
            <div class="code-block">
                <div style="color: #4ECDC4;">// ‚úÖ Function Declaration - HOISTED</div>
                <div>function myFunction() { return "hoisted"; }</div>
                <div>myFunction(); // Works fine</div>
                <div></div>
                <div style="color: #FF6B6B;">// ‚ùå Function Expression - NOT HOISTED</div>
                <div>const myFunction = () => { return "not hoisted"; };</div>
                <div>myFunction(); // Error if called before declaration</div>
                <div></div>
                <div style="color: #FF6B6B;">// ‚ùå Arrow Function - NOT HOISTED</div>
                <div>const myArrow = () => { return "not hoisted"; };</div>
                <div>myArrow(); // Error if called before declaration</div>
            </div>
        </div>

        <div class="test-section">
            <h3>üé® Component Structure After Fix</h3>
            <div class="code-block">
                <div>const TryoutReviewPage = () => {</div>
                <div>  // 1. State declarations</div>
                <div>  const [session, setSession] = useState(null);</div>
                <div>  const [packageData, setPackageData] = useState(null);</div>
                <div>  // ... other states</div>
                <div></div>
                <div>  // 2. Function declarations (BEFORE useEffect)</div>
                <div>  const loadTagStats = async () => { ... };</div>
                <div>  const getAccuracyColor = (accuracy) => { ... };</div>
                <div>  const formatTime = (seconds) => { ... };</div>
                <div></div>
                <div>  // 3. useEffect hooks (AFTER function declarations)</div>
                <div>  useEffect(() => {</div>
                <div>    if (session && session.status === 'completed') {</div>
                <div>      loadTagStats(); // ‚úÖ Now works!</div>
                <div>    }</div>
                <div>  }, [session]);</div>
                <div></div>
                <div>  // 4. Component render</div>
                <div>  return (...);</div>
                <div>};</div>
            </div>
        </div>

        <div class="log-panel">
            <h3>üìù Test Log</h3>
            <div id="logContainer">
                <div class="log-entry log-success">System initialized. Review page fix applied successfully.</div>
            </div>
        </div>
    </div>

    <script>
        class ReviewPageFixTest {
            constructor() {
                this.initialize();
            }
            
            initialize() {
                this.log('üöÄ Initializing review page fix test...');
                this.log('üìã Test scenarios:');
                this.log('   ‚Ä¢ Test function declaration order');
                this.log('   ‚Ä¢ Test JavaScript hoisting behavior');
                this.log('   ‚Ä¢ Test error prevention');
                this.log('   ‚Ä¢ Test component flow');
                this.log('   ‚Ä¢ Simulate the fix');
            }
            
            testFunctionOrder() {
                this.log('üîç Testing function declaration order...', 'info');
                this.log('‚úÖ loadTagStats declared before useEffect');
                this.log('‚úÖ Function expressions must be declared before use');
                this.log('‚úÖ Arrow functions are not hoisted');
                this.log('‚úÖ const/let declarations are not hoisted');
                this.log('‚úÖ Only function declarations are hoisted');
            }
            
            testHoisting() {
                this.log('üîç Testing JavaScript hoisting behavior...', 'info');
                this.log('‚úÖ Function declarations: function foo() {} - HOISTED');
                this.log('‚úÖ Function expressions: const foo = () => {} - NOT HOISTED');
                this.log('‚úÖ Arrow functions: const foo = () => {} - NOT HOISTED');
                this.log('‚úÖ Variable declarations: var foo - HOISTED (undefined)');
                this.log('‚úÖ Const/let declarations: const foo - NOT HOISTED (TDZ)');
            }
            
            testErrorPrevention() {
                this.log('üîç Testing error prevention...', 'info');
                this.log('‚úÖ Error "Cannot access before initialization" prevented');
                this.log('‚úÖ Function loadTagStats now accessible in useEffect');
                this.log('‚úÖ Component renders without JavaScript errors');
                this.log('‚úÖ Tag statistics load properly for completed sessions');
                this.log('‚úÖ User can navigate to review page successfully');
            }
            
            testComponentFlow() {
                this.log('üîç Testing component flow...', 'info');
                this.log('‚úÖ Component mounts successfully');
                this.log('‚úÖ useEffect triggers data loading');
                this.log('‚úÖ Session data loads first');
                this.log('‚úÖ Package data loads second');
                this.log('‚úÖ Questions and answers load third');
                this.log('‚úÖ Tag stats load when session is completed');
                this.log('‚úÖ Component renders review interface');
            }
            
            simulateFix() {
                this.log('üîç Simulating the fix...', 'info');
                this.log('‚úÖ Before: loadTagStats called before declaration');
                this.log('‚úÖ After: loadTagStats declared before useEffect');
                this.log('‚úÖ Result: No more initialization errors');
                this.log('‚úÖ Review page loads successfully');
                this.log('‚úÖ User can view completed tryout results');
                this.log('‚úÖ Navigation between questions works');
                this.log('‚úÖ Tag statistics display correctly');
            }
            
            log(message, type = 'info') {
                const logContainer = document.getElementById('logContainer');
                const logEntry = document.createElement('div');
                logEntry.className = `log-entry log-${type}`;
                
                const timestamp = new Date().toLocaleTimeString();
                logEntry.textContent = `[${timestamp}] ${message}`;
                
                logContainer.appendChild(logEntry);
                logContainer.scrollTop = logContainer.scrollHeight;
                
                // Keep only last 30 log entries
                while (logContainer.children.length > 30) {
                    logContainer.removeChild(logContainer.firstChild);
                }
                
                console.log(`[${type.toUpperCase()}] ${message}`);
            }
        }
        
        // Initialize test
        let reviewPageFixTest;
        
        document.addEventListener('DOMContentLoaded', () => {
            reviewPageFixTest = new ReviewPageFixTest();
        });
        
        // Global functions for buttons
        function testFunctionOrder() {
            if (reviewPageFixTest) reviewPageFixTest.testFunctionOrder();
        }
        
        function testHoisting() {
            if (reviewPageFixTest) reviewPageFixTest.testHoisting();
        }
        
        function testErrorPrevention() {
            if (reviewPageFixTest) reviewPageFixTest.testErrorPrevention();
        }
        
        function testComponentFlow() {
            if (reviewPageFixTest) reviewPageFixTest.testComponentFlow();
        }
        
        function simulateFix() {
            if (reviewPageFixTest) reviewPageFixTest.simulateFix();
        }
        
        console.log('‚úÖ Review Page Fix Test loaded!');
        console.log('üìã Test the fix for loadTagStats initialization error');
    </script>
</body>
</html>
